<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Obisign OCR</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2/dist/tesseract.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 1rem; }
    video, canvas, img { max-width: 100%; }
    .info { margin-top: 1rem; }
    .ocr-result { background: #eef; padding: 1rem; margin-top: 1rem; }
  </style>
</head>
<body>

<h2>Obisign OCR - ‡∏≠‡πà‡∏≤‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£</h2>

<video id="video" autoplay playsinline style="border:1px solid #000;"></video><br/>
<button onclick="startCamera()">üì∑ ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á</button>
<button onclick="captureImage()">üì∏ ‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û</button>

<canvas id="canvas" style="display:none;"></canvas>
<img id="capturedImage" style="margin-top:1rem; display:none;" />

<div class="info">
  <button onclick="runOCR()">üîç ‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏†‡∏≤‡∏û</button>
</div>

<div class="ocr-result" id="ocrText" style="display:none;">
  <h3>üìÑ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ:</h3>
  <pre id="textOutput"></pre>
  <p><strong>‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£:</strong> <span id="idCard"></span></p>
  <p><strong>‡∏ä‡∏∑‡πà‡∏≠:</strong> <span id="fullName"></span></p>
</div>

<script>
const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
const img = document.getElementById('capturedImage');
const ctx = canvas.getContext('2d');

function startCamera() {
  navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
    .then(stream => video.srcObject = stream)
    .catch(err => alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á"));
}

function captureImage() {
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  ctx.drawImage(video, 0, 0);
  const dataUrl = canvas.toDataURL('image/jpeg');
  img.src = dataUrl;
  img.style.display = 'block';
}

function runOCR() {
  document.getElementById("ocrText").style.display = "block";
  Tesseract.recognize(img.src, 'tha+eng', {
    logger: m => console.log(m)
  }).then(({ data: { text } }) => {
    document.getElementById("textOutput").textContent = text;

    const idMatch = text.match(/\d{13}/);
    const nameMatch = text.match(/‡∏ä‡∏∑‡πà‡∏≠[\s\S]{1,30}/);

    document.getElementById("idCard").textContent = idMatch ? idMatch[0] : "‡πÑ‡∏°‡πà‡∏û‡∏ö";
    document.getElementById("fullName").textContent = nameMatch ? nameMatch[0].replace("‡∏ä‡∏∑‡πà‡∏≠", "").trim() : "‡πÑ‡∏°‡πà‡∏û‡∏ö";
  });
}
</script>

</body>
</html>
